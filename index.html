<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Invoice Scanner</title>

<!-- Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,Arial}
body{
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;min-height:100vh;padding:20px
}
.container{max-width:420px;margin:auto}
h1{text-align:center;margin-bottom:10px}
.status{text-align:center;font-size:.9em;opacity:.8;margin-bottom:10px}

.scanner{
  position:relative;
  width:100%;
  height:420px;
  background:#000;
  border-radius:20px;
  overflow:hidden;
  box-shadow:0 0 30px rgba(0,255,200,.4)
}

video,canvas{width:100%;height:100%;object-fit:cover}

.scan-line{
  position:absolute;
  width:100%;
  height:3px;
  background:lime;
  animation:scan 2s linear infinite;
}
@keyframes scan{
  0%{top:0}50%{top:100%}100%{top:0}
}

.controls, .actions{
  display:flex;
  gap:10px;
  margin-top:12px;
}

button{
  flex:1;
  padding:12px;
  border:none;
  border-radius:30px;
  font-weight:bold;
  cursor:pointer;
}
.primary{background:#00ffcc;color:#000}
.secondary{background:#444;color:#fff}
.success{background:#25d366;color:#000}

input{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:10px;
  border:none;
}

.storage{
  margin-top:15px;
  background:rgba(0,0,0,.3);
  padding:10px;
  border-radius:10px;
  max-height:150px;
  overflow:auto;
}

.invoice{
  font-size:.85em;
  border-bottom:1px solid rgba(255,255,255,.2);
  padding:5px 0;
}
</style>
</head>

<body>
<div class="container">

<h1>ðŸ“„ Smart Invoice Scanner</h1>
<div class="status" id="status">Camera off</div>

<div class="scanner">
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" hidden></canvas>
  <div class="scan-line" id="scanLine" style="display:none"></div>
</div>

<div class="controls">
  <button class="primary" onclick="startCamera()"><i class="fa fa-camera"></i> Open Camera</button>
  <button class="secondary" onclick="capture()"><i class="fa fa-circle"></i> Capture</button>
</div>

<input id="lpo" placeholder="LPO / Invoice Number">
<input id="supplier" placeholder="Supplier Name">

<div class="actions">
  <button class="primary" onclick="savePDF()">â¬‡ PDF</button>
  <button class="success" onclick="share()">ðŸ“¤ WhatsApp</button>
</div>

<div class="storage" id="storage">
  <b>Stored Invoices</b>
</div>

</div>

<script>
let stream;
let imageData;

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const status = document.getElementById('status');
const scanLine = document.getElementById('scanLine');
const storage = document.getElementById('storage');

function startCamera(){
  navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
  .then(s=>{
    stream=s;
    video.srcObject=s;
    scanLine.style.display="block";
    status.innerText="Camera active â€“ align invoice";
  })
}

function capture(){
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  ctx.drawImage(video,0,0);
  imageData=canvas.toDataURL("image/jpeg");
  scanLine.style.display="none";
  status.innerText="Invoice captured âœ”";
}

function savePDF(){
  if(!imageData)return alert("Capture invoice first");
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("p","mm","a4");
  pdf.addImage(imageData,"JPEG",0,0,210,297);
  const lpo=document.getElementById("lpo").value||"Invoice";
  pdf.save(lpo+".pdf");
  saveLocal(lpo);
}

function saveLocal(lpo){
  const supplier=document.getElementById("supplier").value||"Unknown";
  const item={lpo,supplier,date:new Date().toLocaleString()};
  const list=JSON.parse(localStorage.getItem("invoices")||"[]");
  list.push(item);
  localStorage.setItem("invoices",JSON.stringify(list));
  render();
}

function render(){
  const list=JSON.parse(localStorage.getItem("invoices")||"[]");
  storage.innerHTML="<b>Stored Invoices</b>";
  list.forEach(i=>{
    storage.innerHTML+=`<div class="invoice">ðŸ“„ ${i.lpo} â€“ ${i.supplier}<br><small>${i.date}</small></div>`;
  });
}
render();

function share(){
  window.open("https://wa.me/?text="+encodeURIComponent("Invoice scanned and ready"));
}
</script>

</body>
</html>
